# Template file for 'CalculiX-cgx'
pkgname=CalculiX-cgx
version=2.20
revision=1
create_wrksrc=yes
build_wrksrc="CalculiX/cgx_${version}/src"
build_style="gnu-makefile"
makedepends="glu-devel libglvnd-devel libXmu-devel libXi-devel"
short_desc="3D Structural Finite Element Program - Graphical interface"
maintainer="Phicem <phicem@gmx.com>"
license="GPL-2.0-or-later, custom:GLUT"
homepage="http://www.dhondt.de/"
distfiles="http://www.dhondt.de/cgx_${version}.all.tar.bz2"
checksum=f4c840c3633718547e33f86b2d7bc6b35608dd8d6cbf9fa192cecef34f2dc908
CFLAGS="-DSEMINIT -I. -I${XBPS_CROSS_BASE}/usr/include/GL -I${XBPS_CROSS_BASE}/usr/X11/include -I../../libSNL/src -I../../glut-3.5/src"
_tetgen_version=1.5.1
_tetgen_dir=${XBPS_BUILDDIR}/${pkgname}-${version}/tetgen${_tetgen_version}

post_build() {
	make -C ${_tetgen_dir}  CC=$CC CXX=$CXX CFLAGS="$CFLAGS" tetgen tetlib
}

do_install() {
	vbin cgx
	vlicense ../README CGX_LICENSE
	vlicense ../../glut-3.5/NOTICE GLUT_LICENSE
	vbin ${_tetgen_dir}/tetgen
	vinstall ${_tetgen_dir}/libtet.a 644 usr/lib
	vlicense ${_tetgen_dir}/LICENSE TETGEN_LICENSE
}

post_extract() {
	bsdtar -xvf tetgen${_tetgen_version}.tar
	rm tetgen${_tetgen_version}.tar
}
